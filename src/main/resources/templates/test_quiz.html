<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-1.11.1.min.js"></script>
    <link rel="stylesheet" href="/css/test_quiz.css">
    <script src="/js/style.js"></script>
    <script src="/js/test_quiz.js"></script>


    <link href="https://fonts.googleapis.com/css?family=Sawarabi+Gothic" rel="stylesheet">
    <title>Test-quiz</title>

</head>
<body>

<form name="form_countdown">
    <input name="counter" type="hidden" value="4"  style="border:none; background-color:transparent;">
</form>

<div class="quiz_zentai">

    <div class="marudisplay" id="marudisplay">
        <img src="/images/test/maru.png">
    </div>

    <div class="hazuredisplay" id="hazuredisplay">
        <img src="/images/test/batu.png">
    </div>

    <div class="tugiedisplay" id="tugiedisplay">

        <div th:object="${testwords.get(0)}">


            <form th:action="@{/sense/test_question/__${testwords.get(0).id}__/__${testNumber}__}" method="post">
            　<input type="image" src="/images/test/nextquestion.png"/>　　　　　　　
            </form>

        </div>
    </div>

    <div class = "resultButtonDisplay" id = "resultButtonDisplay">
        <form th:action="@{/sense/test_result/{id}(id=${testNumber})}" method="post">
            　<input type="image" src ="/images/test/finish.png" >　　　　　　　
        </form>
    </div>


    <div class="overdisplay" id="overdisplay">
        <img src="/images/test/over.png">
    </div>

    <div class="container">
        <div id="timer"></div>
        <form id="form" class="form-inline">
            <div class="form-group">
            </div>
        </form>
    </div>



    <script>

        var maruimg = document.getElementById('marudisplay');
        var hazureimg = document.getElementById('hazuredisplay');
        var tugieimg = document.getElementById('tugiedisplay');
        var overimg = document.getElementById('overdisplay');
        var resultButtonImg = document.getElementById('resultButtonDisplay');
        maruimg.style.display = "none";
        hazureimg.style.display = "none";
        tugieimg.style.display  = "none";
        overimg.style.display  = "none";
        resultButtonImg.style.display  = "none";
        function changepage(id) {
            tugieimg.style.display = "block";
            if (id == 1) {
                $('#timer').timer(0);
                maruimg.style.display = "block";
                setTimeout(function change() {
                    maruimg.style.display = "none";
                }, 1000);
                tugieimg.style.display = "block";
                countstop();
            }
            else if (id == 2) {
                $('#timer').timer(0);
                tugieimg.style.display = "none";
                hazureimg.style.display = "block";
                setTimeout(function change() {
                    window.location.href = '/sense/test_quiz';
                }, 1000);
                countstop();
            }
            else if (id == 0) {
                $('#timer').timer(0);
                maruimg.style.display = "block";
                tugieimg.style.display = "none";
                setTimeout(function change() {
                    maruimg.style.display = "none";
                    resultButtonImg.style.display = "block";
                }, 1000);
                countstop();
            }

        }

        window.onload =function countstart() {
            count = eval(document.form_countdown.counter.value);
            timerID = setInterval('countdown()',1000);
            //開始ボタンを使用禁止
            $('#timer').timer(5);
        }

        function countstop() {
            clearInterval(timerID);
            document.form_countdown.start.disabled = false; //開始ボタンを解除
            document.form_countdown.reset(); //初期値に戻す

        }

        function countdown() {
            document.form_countdown.counter.value = count; //カウント表示
            count--; //カウントダウン

            if (count < 0) {
                overimg.style.display  = "block";
                setTimeout(function change() {

                    location.href = "/sense/test_quiz";
                }, 2000);
            }
            //カウント終了 */
        }
    </script>

    <div class="test_eigo">
        <tr  th:object="${testwords.get(0)}">
            <td th:text="*{word}"></td>
        </tr>
        <div th:text = "${testNumber}"></div>
    </div>
    <br><br>

    <div class="test_nihongo">


                <div th:each=" word : ${testwords.get(0).getShuffledAnswers()}">
                    <div th:each=" option : ${testwords.get(0)}">

                <div th:if="${lastid}">
                    <div th:switch="${word}">

                        <span th:case="${option.meaning}" onClick="changepage(0)">
                              <div class="nihongo_btn" th:text="${word}" onclick="audio_play()"></div><br>
                        </span>


                        <span th:case="*" onClick="changepage(2)">
                              <div class="nihongo_btn" th:text="${word}" onclick="audiobatu_play()"></div>
                              <form th:action="@{/sense/test_quiz/}" method="get" />　
                            </form>
                        </span>

                    </div>
                </div>

                <div th:unless="${lastid}">
                    <div th:switch="${word}">

                            <span th:case="${option.meaning}" onClick="changepage(1)">
                                  <div class="nihongo_btn" th:text="${word}" onclick="audio_play()"></div><br>
                            </span>


                            <span th:case="*" onClick="changepage(2)">
                                      <div class="nihongo_btn" th:text="${word}" onclick="audiobatu_play()"></div>
                                      <form th:action="@{/sense/test_quiz/}" method="get" />　
                                </form>
                            </span>

                    </div>
                </div>
            </div>
        </div>
        </span>

        <a class="homeback" href="/sense/mypage"><img src="/images/mypage/home.png"></a>

        <audio id="audio" >
            <source src="/audio/crrect_answer.mp3">
        </audio>
        <audio id="audiobatu" >
            <source src="/audio/batu.mp3">
        </audio>

        <audio id="audiohome" >
            <source src="/audio/home.mp3">
        </audio>

        <script type="text/javascript">
            function audio_play() {
                audio.play();
            }
            function audiobatu_play() {
                audiobatu.play();
            }

        </script>
 </div>
</body>
</html>